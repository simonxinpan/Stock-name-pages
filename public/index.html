<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <!-- ... 省略 <head> ... -->
    <style>
        /* ... 省略之前的样式 ... */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5); z-index: 40; }
        .modal-content { max-height: 80vh; }
        .prose-styles h1, .prose-styles h2 { font-weight: bold; margin-top: 1em; margin-bottom: 0.5em; }
        .prose-styles p { margin-bottom: 1em; line-height: 1.6; }
        .prose-styles a { color: #3b82f6; text-decoration: underline; }
    </style>
</head>
<body class="bg-gray-50" x-data="liveStockApp()" x-init="init()">
    
    <!-- ... 省略 nav 和 main HTML 结构，只在 main 内部修改新闻部分 ... -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6" x-show="!loading && quote" x-cloak>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-2 space-y-6">
                <!-- ... 省略 K线图部分 ... -->
                
                <!-- 相关新闻 (已修改) -->
                <div class="bg-white rounded-lg card-shadow p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4" x-text="language === 'zh' ? '相关新闻' : 'Related News'"></h3>
                    <div class="max-h-96 overflow-y-auto space-y-3">
                        <template x-for="article in news.slice(0, 10)" :key="article.id">
                            <!-- *** 关键改动：点击时调用 openArticleModal *** -->
                            <div @click="openArticleModal(article.url)" class="cursor-pointer border-b border-gray-100 pb-3 last:border-b-0">
                                <div class="block hover:bg-gray-50 rounded p-2 transition-colors">
                                    <h4 class="text-sm font-medium text-gray-900 mb-1 line-clamp-2" x-text="article.headline"></h4>
                                    <p class="text-xs text-gray-600" x-text="formatNewsTime(article.datetime)"></p>
                                    <p class="text-xs text-gray-500 mt-1" x-text="article.source"></p>
                                </div>
                            </div>
                        </template>
                        <!-- ... -->
                    </div>
                </div>
            </div>
            <!-- ... 省略右侧边栏 ... -->
        </div>
    </main>

    <!-- *** 新增的新闻模态框 *** -->
    <div x-show="isModalOpen" class="modal-overlay flex items-center justify-center" @click.self="isModalOpen = false" x-cloak>
        <div class="bg-white rounded-lg card-shadow w-11/12 md:w-3/4 lg:w-1/2" @click.stop>
            <div class="p-6">
                <div x-show="articleLoading" class="animate-pulse">
                    <div class="h-8 bg-gray-200 rounded w-3/4 mb-4"></div>
                    <div class="h-4 bg-gray-200 rounded w-full mb-2"></div>
                    <div class="h-4 bg-gray-200 rounded w-full mb-2"></div>
                    <div class="h-4 bg-gray-200 rounded w-5/6"></div>
                </div>
                <div x-show="!articleLoading">
                    <h2 class="text-2xl font-bold mb-2" x-text="currentArticle.title"></h2>
                    <p class="text-sm text-gray-500 mb-4" x-text="currentArticle.author || currentArticle.siteName"></p>
                    <div class="modal-content overflow-y-auto prose-styles" x-html="currentArticle.content"></div>
                </div>
            </div>
            <div class="bg-gray-50 px-6 py-3 flex justify-end">
                <button @click="isModalOpen = false" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">Close</button>
            </div>
        </div>
    </div>

    <script>
        function liveStockApp() {
            return {
                // ... 省略所有 state ...
                isModalOpen: false, // <-- 新增
                articleLoading: false, // <-- 新增
                currentArticle: { title: '', content: '' }, // <-- 新增

                // ... 省略 init, loadStock, changePeriod 等函数 ...

                // *** 新增的打开文章模态框函数 ***
                async openArticleModal(url) {
                    this.isModalOpen = true;
                    this.articleLoading = true;
                    this.currentArticle = { title: 'Loading...', content: '<p>Fetching and translating content...</p>' };

                    try {
                        const apiUrl = `/api/news/content?url=${encodeURIComponent(url)}&lang=${this.language}`;
                        const articleData = await fetch(apiUrl).then(res => this.handleResponse(res));
                        this.currentArticle = articleData;
                    } catch (error) {
                        this.currentArticle.title = 'Error';
                        this.currentArticle.content = `<p>Failed to load or translate the article: ${error.message}</p>`;
                    } finally {
                        this.articleLoading = false;
                    }
                },
                
                // ... 省略其他所有函数 ...
            }
        }
    </script>
</body>
</html>