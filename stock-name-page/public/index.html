<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êô∫ËÉΩ‰∏™ËÇ°ËØ¶ÊÉÖÈ°µ - Êú¨Âú∞ÊºîÁ§∫Áâà</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .price-up { color: #ef4444; }
        .price-down { color: #10b981; }
        .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #1f2937;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .loading {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-connected { background-color: #10b981; }
        .status-disconnected { background-color: #ef4444; }
        .status-connecting { background-color: #f59e0b; animation: pulse 1s infinite; }
        .live-badge {
            background: linear-gradient(45deg, #ef4444, #f59e0b);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            animation: glow 2s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from { box-shadow: 0 0 5px rgba(239, 68, 68, 0.5); }
            to { box-shadow: 0 0 20px rgba(239, 68, 68, 0.8); }
        }
        .demo-badge {
            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .info-message {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            color: #1d4ed8;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .loading-skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body class="bg-gray-50" x-data="liveStockApp()">
    <!-- È°∂ÈÉ®ÂØºËà™Ê†è -->
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <h1 class="text-xl font-bold text-gray-900" x-text="language === 'zh' ? 'Êô∫ËÉΩ‰∏™ËÇ°ËØ¶ÊÉÖÈ°µ' : 'Smart Stock Detail'"></h1>
                    <span class="demo-badge">Êú¨Âú∞ÊºîÁ§∫</span>
                    <div class="flex items-center space-x-2">
                        <span class="status-indicator" :class="connectionStatus"></span>
                        <span class="text-sm text-gray-600" x-text="getConnectionText()"></span>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <select 
                            x-model="symbol" 
                            @change="loadStock()"
                            class="px-3 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        >
                            <option value="AAPL">AAPL - ËãπÊûú</option>
                            <option value="TSLA">TSLA - ÁâπÊñØÊãâ</option>
                            <option value="MSFT">MSFT - ÂæÆËΩØ</option>
                            <option value="GOOGL">GOOGL - Ë∞∑Ê≠å</option>
                            <option value="AMZN">AMZN - ‰∫öÈ©¨ÈÄä</option>
                        </select>
                        <button 
                            @click="loadStock()"
                            :disabled="loading"
                            class="px-3 py-1 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            <span x-show="!loading" x-text="language === 'zh' ? 'Âà∑Êñ∞' : 'Refresh'"></span>
                            <span x-show="loading" class="loading">...</span>
                        </button>
                    </div>
                    <button 
                        @click="toggleLanguage()"
                        class="px-3 py-1 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors"
                        x-text="language === 'zh' ? 'EN' : '‰∏≠Êñá'">
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ‰ø°ÊÅØÊèêÁ§∫ -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-4">
        <div class="info-message">
            <p x-text="language === 'zh' ? 'üìç ËøôÊòØÊú¨Âú∞ÊºîÁ§∫ÁâàÊú¨Ôºå‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆÂ±ïÁ§∫ÂäüËÉΩ„ÄÇË¶ÅËøûÊé•ÁúüÂÆûAPIÔºåËØ∑ÈÉ®ÁΩ≤Âà∞VercelÂπ∂ÈÖçÁΩÆFinnhub APIÂØÜÈí•„ÄÇ' : 'üìç This is a local demo version using simulated data. To connect to real APIs, deploy to Vercel and configure Finnhub API key.'"></p>
        </div>
    </div>

    <!-- ÈîôËØØÊèêÁ§∫ -->
    <div x-show="error" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-4">
        <div class="error-message">
            <p x-text="error"></p>
        </div>
    </div>

    <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- ËÇ°Á•®Âü∫Êú¨‰ø°ÊÅØ -->
        <div class="bg-white rounded-lg card-shadow p-6 mb-6">
            <div x-show="loading && !stockData" class="animate-pulse">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
                    <div class="flex items-center space-x-4 mb-4 lg:mb-0">
                        <div class="w-16 h-16 bg-gray-200 rounded-lg loading-skeleton"></div>
                        <div>
                            <div class="h-8 bg-gray-200 rounded w-32 mb-2 loading-skeleton"></div>
                            <div class="h-6 bg-gray-200 rounded w-48 mb-1 loading-skeleton"></div>
                            <div class="h-4 bg-gray-200 rounded w-24 loading-skeleton"></div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="h-12 bg-gray-200 rounded w-32 mb-2 loading-skeleton"></div>
                        <div class="h-6 bg-gray-200 rounded w-24 loading-skeleton"></div>
                    </div>
                </div>
            </div>
            
            <div x-show="!loading || stockData">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
                    <div class="flex items-center space-x-4 mb-4 lg:mb-0">
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-100 to-blue-200 rounded-lg flex items-center justify-center">
                            <span class="text-2xl font-bold text-blue-600" x-text="symbol"></span>
                        </div>
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900" x-text="symbol"></h1>
                            <p class="text-lg text-gray-600" x-text="companyProfile?.name || 'Loading...'"></p>
                            <p class="text-sm text-gray-500" x-text="companyProfile?.exchange || 'Loading...'"></p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-3xl font-bold" :class="quote?.d >= 0 ? 'price-up' : 'price-down'" x-text="formatPrice(quote?.c)"></div>
                        <div class="flex items-center justify-end space-x-2 mt-1">
                            <span :class="quote?.d >= 0 ? 'price-up' : 'price-down'" x-text="formatChange(quote?.d)"></span>
                            <span :class="quote?.d >= 0 ? 'price-up' : 'price-down'" x-text="formatPercent(quote?.dp)"></span>
                        </div>
                        <div class="text-sm text-gray-500 mt-1" x-text="getLastUpdateText()"></div>
                    </div>
                </div>
                
                <!-- ËØ¶ÁªÜË¥¢Âä°Êï∞ÊçÆ -->
                <div class="mt-6 pt-6 border-t border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4" x-text="language === 'zh' ? 'ÂÖ≥ÈîÆÊåáÊ†á' : 'Key Metrics'"></h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                        <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors">
                            <div class="tooltip">
                                <h4 class="text-sm font-medium text-gray-600 mb-1 cursor-help" x-text="language === 'zh' ? 'ÂºÄÁõò‰ª∑' : 'Open'"></h4>
                                <span class="tooltiptext" x-text="language === 'zh' ? '‰ªäÊó•ÂºÄÁõò‰ª∑Ê†º' : 'Today\'s opening price'"></span>
                            </div>
                            <p class="text-lg font-bold text-gray-900" x-text="formatPrice(quote?.o)"></p>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors">
                            <div class="tooltip">
                                <h4 class="text-sm font-medium text-gray-600 mb-1 cursor-help" x-text="language === 'zh' ? 'ÊúÄÈ´ò‰ª∑' : 'High'"></h4>
                                <span class="tooltiptext" x-text="language === 'zh' ? '‰ªäÊó•ÊúÄÈ´ò‰ª∑Ê†º' : 'Today\'s highest price'"></span>
                            </div>
                            <p class="text-lg font-bold text-gray-900" x-text="formatPrice(quote?.h)"></p>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors">
                            <div class="tooltip">
                                <h4 class="text-sm font-medium text-gray-600 mb-1 cursor-help" x-text="language === 'zh' ? 'ÊúÄ‰Ωé‰ª∑' : 'Low'"></h4>
                                <span class="tooltiptext" x-text="language === 'zh' ? '‰ªäÊó•ÊúÄ‰Ωé‰ª∑Ê†º' : 'Today\'s lowest price'"></span>
                            </div>
                            <p class="text-lg font-bold text-gray-900" x-text="formatPrice(quote?.l)"></p>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors">
                            <div class="tooltip">
                                <h4 class="text-sm font-medium text-gray-600 mb-1 cursor-help" x-text="language === 'zh' ? 'ÂâçÊî∂Áõò' : 'Prev Close'"></h4>
                                <span class="tooltiptext" x-text="language === 'zh' ? 'Ââç‰∏Ä‰∫§ÊòìÊó•Êî∂Áõò‰ª∑' : 'Previous trading day closing price'"></span>
                            </div>
                            <p class="text-lg font-bold text-gray-900" x-text="formatPrice(quote?.pc)"></p>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors">
                            <div class="tooltip">
                                <h4 class="text-sm font-medium text-gray-600 mb-1 cursor-help" x-text="language === 'zh' ? 'Â∏ÇÂÄº' : 'Market Cap'"></h4>
                                <span class="tooltiptext" x-text="language === 'zh' ? 'ÂÖ¨Âè∏ÊÄªÂ∏ÇÂÄº' : 'Total market capitalization'"></span>
                            </div>
                            <p class="text-lg font-bold text-gray-900" x-text="formatMarketCap(companyProfile?.marketCapitalization)"></p>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors">
                            <div class="tooltip">
                                <h4 class="text-sm font-medium text-gray-600 mb-1 cursor-help" x-text="language === 'zh' ? 'Êàê‰∫§Èáè' : 'Volume'"></h4>
                                <span class="tooltiptext" x-text="language === 'zh' ? '‰ªäÊó•Êàê‰∫§Èáè' : 'Today\'s trading volume'"></span>
                            </div>
                            <p class="text-lg font-bold text-gray-900" x-text="formatVolume(quote?.v)"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‰∏ªË¶ÅÂÜÖÂÆπÁΩëÊ†º -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- KÁ∫øÂõæÂå∫Âüü -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg card-shadow p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-semibold text-gray-900" x-text="language === 'zh' ? '‰ª∑Ê†ºËµ∞Âäø' : 'Price Chart'"></h2>
                        <div class="flex space-x-2">
                            <template x-for="period in timePeriods" :key="period.value">
                                <button 
                                    @click="selectedPeriod = period.value; loadCandles()"
                                    :class="selectedPeriod === period.value ? 'bg-blue-500 text-white shadow-lg' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                                    class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 transform hover:scale-105"
                                    x-text="language === 'zh' ? period.zh : period.en">
                                </button>
                            </template>
                        </div>
                    </div>
                    <div class="h-96 bg-gray-50 rounded-lg flex items-center justify-center">
                        <canvas id="stockChart" width="600" height="300"></canvas>
                    </div>
                </div>
            </div>

            <!-- Ë¥¢Âä°ÊåáÊ†áÂíåÂÖ¨Âè∏‰ø°ÊÅØ -->
            <div class="space-y-6">
                <!-- Ë¥¢Âä°ÊåáÊ†á -->
                <div class="bg-white rounded-lg card-shadow p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4" x-text="language === 'zh' ? 'Ë¥¢Âä°ÊåáÊ†á' : 'Financial Metrics'"></h3>
                    <div class="space-y-4">
                        <template x-for="metric in getFinancialMetrics()" :key="metric.key">
                            <div class="flex justify-between items-center py-3 border-b border-gray-100 last:border-b-0 hover:bg-gray-50 rounded px-2 transition-colors">
                                <div class="tooltip flex-1">
                                    <span class="text-sm text-gray-600 cursor-help" x-text="language === 'zh' ? metric.zh : metric.en"></span>
                                    <span class="tooltiptext" x-text="language === 'zh' ? metric.tooltip_zh : metric.tooltip_en"></span>
                                </div>
                                <div class="text-right">
                                    <span class="font-semibold text-gray-900" x-text="metric.value"></span>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- ÂÖ¨Âè∏‰ø°ÊÅØ -->
                <div class="bg-white rounded-lg card-shadow p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4" x-text="language === 'zh' ? 'ÂÖ¨Âè∏‰ø°ÊÅØ' : 'Company Info'"></h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center py-2 hover:bg-gray-50 rounded px-2 transition-colors">
                            <span class="text-sm text-gray-600" x-text="language === 'zh' ? 'Ë°å‰∏ö:' : 'Industry:'"></span>
                            <span class="text-sm font-medium text-gray-900" x-text="companyProfile?.finnhubIndustry || 'N/A'"></span>
                        </div>
                        <div class="flex justify-between items-center py-2 hover:bg-gray-50 rounded px-2 transition-colors">
                            <span class="text-sm text-gray-600" x-text="language === 'zh' ? 'ÂõΩÂÆ∂:' : 'Country:'"></span>
                            <span class="text-sm font-medium text-gray-900" x-text="companyProfile?.country || 'N/A'"></span>
                        </div>
                        <div class="flex justify-between items-center py-2 hover:bg-gray-50 rounded px-2 transition-colors">
                            <span class="text-sm text-gray-600" x-text="language === 'zh' ? 'Ë¥ßÂ∏Å:' : 'Currency:'"></span>
                            <span class="text-sm font-medium text-gray-900" x-text="companyProfile?.currency || 'N/A'"></span>
                        </div>
                        <div class="flex justify-between items-center py-2 hover:bg-gray-50 rounded px-2 transition-colors">
                            <span class="text-sm text-gray-600" x-text="language === 'zh' ? 'ÂëòÂ∑•Êï∞:' : 'Employees:'"></span>
                            <span class="text-sm font-medium text-gray-900" x-text="formatNumber(companyProfile?.employeeTotal)"></span>
                        </div>
                        <div class="py-2" x-show="companyProfile?.weburl">
                            <span class="text-sm text-gray-600" x-text="language === 'zh' ? 'ÂÆòÁΩë:' : 'Website:'"></span>
                            <a :href="companyProfile?.weburl" target="_blank" class="text-sm font-medium text-blue-600 hover:text-blue-800 ml-2 block mt-1" x-text="companyProfile?.weburl"></a>
                        </div>
                    </div>
                </div>

                <!-- ÂÆûÊó∂Êñ∞Èóª -->
                <div class="bg-white rounded-lg card-shadow p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4" x-text="language === 'zh' ? 'Áõ∏ÂÖ≥Êñ∞Èóª' : 'Related News'"></h3>
                    <div class="space-y-3">
                        <template x-for="article in news" :key="article.id">
                            <div class="border-b border-gray-100 pb-3 last:border-b-0">
                                <a :href="article.url" target="_blank" class="block hover:bg-gray-50 rounded p-2 transition-colors cursor-pointer">
                                    <h4 class="text-sm font-medium text-gray-900 mb-1 line-clamp-2" x-text="article.headline"></h4>
                                    <p class="text-xs text-gray-600" x-text="formatNewsTime(article.datetime)"></p>
                                    <p class="text-xs text-gray-500 mt-1" x-text="article.source"></p>
                                </a>
                            </div>
                        </template>
                        <div x-show="news.length === 0 && !loading" class="text-center text-gray-500 py-4">
                            <p x-text="language === 'zh' ? 'ÊöÇÊó†Áõ∏ÂÖ≥Êñ∞Èóª' : 'No news available'"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- È°µËÑö -->
    <footer class="bg-white border-t border-gray-200 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="text-center text-sm text-gray-500">
                <p x-text="language === 'zh' ? 'Êú¨Âú∞ÊºîÁ§∫ÁâàÊú¨ | Ê®°ÊãüÊï∞ÊçÆ‰ªÖ‰æõÂ±ïÁ§∫ | ÈÉ®ÁΩ≤Âà∞VercelËé∑ÂèñÁúüÂÆûÊï∞ÊçÆ' : 'Local Demo Version | Simulated data for demonstration | Deploy to Vercel for real data'"></p>
                <p class="mt-1" x-text="'¬© 2024 ' + (language === 'zh' ? 'Êô∫ËÉΩ‰∏™ËÇ°ËØ¶ÊÉÖÈ°µ' : 'Smart Stock Detail Page')"></p>
            </div>
        </div>
    </footer>

    <script>
        function liveStockApp() {
            return {
                // Âü∫Á°ÄÈÖçÁΩÆ
                language: 'zh',
                symbol: 'AAPL',
                loading: false,
                error: null,
                connectionStatus: 'status-connected',
                
                // Êï∞ÊçÆÂ≠òÂÇ®
                quote: null,
                companyProfile: null,
                candles: null,
                news: [],
                stockData: null,
                
                // ÂõæË°®Áõ∏ÂÖ≥
                selectedPeriod: '1D',
                timePeriods: [
                    { value: '1D', zh: 'Êó•ÂÜÖ', en: '1D' },
                    { value: '1W', zh: '1Âë®', en: '1W' },
                    { value: '1M', zh: '1Êúà', en: '1M' },
                    { value: '3M', zh: '3Êúà', en: '3M' },
                    { value: '1Y', zh: '1Âπ¥', en: '1Y' }
                ],
                chart: null,
                
                // Ê®°ÊãüÊï∞ÊçÆ
                mockData: {
                    AAPL: {
                        quote: { c: 175.43, d: 2.15, dp: 1.24, h: 176.82, l: 173.50, o: 174.20, pc: 173.28, v: 45678900 },
                        profile: { name: 'Apple Inc.', exchange: 'NASDAQ', finnhubIndustry: 'Technology', country: 'US', currency: 'USD', employeeTotal: 164000, marketCapitalization: 2800000, weburl: 'https://www.apple.com' },
                        news: [
                            { id: 1, headline: 'AppleÂèëÂ∏ÉÊñ∞Ê¨æiPhone 15Á≥ªÂàó', datetime: Date.now()/1000 - 3600, source: 'Apple Newsroom', url: '#' },
                            { id: 2, headline: 'Apple Q4Ë¥¢Êä•Ë∂ÖÈ¢ÑÊúü', datetime: Date.now()/1000 - 7200, source: 'Reuters', url: '#' },
                            { id: 3, headline: 'AppleÂú®AIÈ¢ÜÂüüÁöÑÊñ∞ÊäïËµÑ', datetime: Date.now()/1000 - 10800, source: 'TechCrunch', url: '#' }
                        ]
                    },
                    TSLA: {
                        quote: { c: 248.50, d: -3.25, dp: -1.29, h: 252.75, l: 246.80, o: 251.20, pc: 251.75, v: 28456700 },
                        profile: { name: 'Tesla, Inc.', exchange: 'NASDAQ', finnhubIndustry: 'Automotive', country: 'US', currency: 'USD', employeeTotal: 127855, marketCapitalization: 790000, weburl: 'https://www.tesla.com' },
                        news: [
                            { id: 1, headline: 'Tesla CybertruckÂºÄÂßãÈáè‰∫ß', datetime: Date.now()/1000 - 1800, source: 'Tesla', url: '#' },
                            { id: 2, headline: 'TeslaÂú®‰∏≠ÂõΩÂ∏ÇÂú∫Ë°®Áé∞Âº∫Âä≤', datetime: Date.now()/1000 - 5400, source: 'Bloomberg', url: '#' }
                        ]
                    },
                    MSFT: {
                        quote: { c: 378.85, d: 4.12, dp: 1.10, h: 380.50, l: 375.20, o: 376.40, pc: 374.73, v: 18234500 },
                        profile: { name: 'Microsoft Corporation', exchange: 'NASDAQ', finnhubIndustry: 'Technology', country: 'US', currency: 'USD', employeeTotal: 221000, marketCapitalization: 2820000, weburl: 'https://www.microsoft.com' },
                        news: [
                            { id: 1, headline: 'Microsoft Azure‰∫ëÊúçÂä°Â¢ûÈïøÂº∫Âä≤', datetime: Date.now()/1000 - 2700, source: 'Microsoft', url: '#' },
                            { id: 2, headline: 'Microsoft Copilot AIÂä©ÊâãÊõ¥Êñ∞', datetime: Date.now()/1000 - 6300, source: 'The Verge', url: '#' }
                        ]
                    },
                    GOOGL: {
                        quote: { c: 142.65, d: 1.85, dp: 1.31, h: 143.20, l: 140.90, o: 141.50, pc: 140.80, v: 22567800 },
                        profile: { name: 'Alphabet Inc.', exchange: 'NASDAQ', finnhubIndustry: 'Technology', country: 'US', currency: 'USD', employeeTotal: 182502, marketCapitalization: 1780000, weburl: 'https://www.google.com' },
                        news: [
                            { id: 1, headline: 'Google Bard AIÊ®°ÂûãÈáçÂ§ßÊõ¥Êñ∞', datetime: Date.now()/1000 - 1200, source: 'Google', url: '#' },
                            { id: 2, headline: 'Google Cloud‰∏öÂä°ÊåÅÁª≠Â¢ûÈïø', datetime: Date.now()/1000 - 4800, source: 'CNBC', url: '#' }
                        ]
                    },
                    AMZN: {
                        quote: { c: 153.75, d: -1.45, dp: -0.93, h: 155.80, l: 152.30, o: 154.90, pc: 155.20, v: 31245600 },
                        profile: { name: 'Amazon.com, Inc.', exchange: 'NASDAQ', finnhubIndustry: 'E-commerce', country: 'US', currency: 'USD', employeeTotal: 1541000, marketCapitalization: 1590000, weburl: 'https://www.amazon.com' },
                        news: [
                            { id: 1, headline: 'Amazon Prime‰ºöÂëòÊï∞ÈáèÂàõÊñ∞È´ò', datetime: Date.now()/1000 - 900, source: 'Amazon', url: '#' },
                            { id: 2, headline: 'Amazon AWSÊé®Âá∫Êñ∞AIÊúçÂä°', datetime: Date.now()/1000 - 3600, source: 'AWS', url: '#' }
                        ]
                    }
                },
                
                // ÂàùÂßãÂåñ
                async init() {
                    // ‰ªélocalStorageÊÅ¢Â§çËØ≠Ë®ÄËÆæÁΩÆ
                    const savedLanguage = localStorage.getItem('language');
                    if (savedLanguage) {
                        this.language = savedLanguage;
                    }
                    
                    // Âä†ËΩΩÂàùÂßãÊï∞ÊçÆ
                    await this.loadStock();
                    
                    // ËÆæÁΩÆÂÆöÊó∂Âà∑Êñ∞ÔºàÊ®°ÊãüÂÆûÊó∂Êõ¥Êñ∞Ôºâ
                    this.startAutoRefresh();
                },
                
                // Âä†ËΩΩËÇ°Á•®Êï∞ÊçÆÔºàÊ®°ÊãüÔºâ
                async loadStock() {
                    this.loading = true;
                    this.error = null;
                    this.connectionStatus = 'status-connecting';
                    
                    try {
                        // Ê®°ÊãüAPIÂª∂Ëøü
                        await new Promise(resolve => setTimeout(resolve, 800));
                        
                        const data = this.mockData[this.symbol];
                        if (!data) {
                            throw new Error('ËÇ°Á•®‰ª£Á†Å‰∏çÂ≠òÂú®');
                        }
                        
                        this.quote = data.quote;
                        this.companyProfile = data.profile;
                        this.news = data.news;
                        this.stockData = { quote: data.quote, profile: data.profile };
                        
                        // ÁîüÊàêÊ®°ÊãüKÁ∫øÊï∞ÊçÆ
                        this.generateMockCandles();
                        this.updateChart();
                        
                        this.connectionStatus = 'status-connected';
                        
                    } catch (error) {
                        this.error = this.language === 'zh' 
                            ? `Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•: ${error.message}` 
                            : `Failed to load data: ${error.message}`;
                        this.connectionStatus = 'status-disconnected';
                    } finally {
                        this.loading = false;
                    }
                },
                
                // ÁîüÊàêÊ®°ÊãüKÁ∫øÊï∞ÊçÆ
                generateMockCandles() {
                    const periods = {
                        '1D': { points: 78, interval: 5 * 60 * 1000 }, // 5ÂàÜÈíüÈó¥Èöî
                        '1W': { points: 35, interval: 4 * 60 * 60 * 1000 }, // 4Â∞èÊó∂Èó¥Èöî
                        '1M': { points: 30, interval: 24 * 60 * 60 * 1000 }, // 1Â§©Èó¥Èöî
                        '3M': { points: 90, interval: 24 * 60 * 60 * 1000 }, // 1Â§©Èó¥Èöî
                        '1Y': { points: 52, interval: 7 * 24 * 60 * 60 * 1000 } // 1Âë®Èó¥Èöî
                    };
                    
                    const config = periods[this.selectedPeriod];
                    const basePrice = this.quote.c;
                    const timestamps = [];
                    const prices = [];
                    const volumes = [];
                    
                    let currentTime = Date.now() - (config.points * config.interval);
                    let currentPrice = basePrice * 0.95; // ‰ªéËæÉ‰Ωé‰ª∑Ê†ºÂºÄÂßã
                    
                    for (let i = 0; i < config.points; i++) {
                        timestamps.push(Math.floor(currentTime / 1000));
                        
                        // ÁîüÊàê‰ª∑Ê†ºÊ≥¢Âä®
                        const volatility = 0.02; // 2%Ê≥¢Âä®Áéá
                        const change = (Math.random() - 0.5) * volatility * currentPrice;
                        currentPrice += change;
                        
                        // Á°Æ‰øùÊúÄÂêé‰∏Ä‰∏™ÁÇπÊé•ËøëÂΩìÂâç‰ª∑Ê†º
                        if (i === config.points - 1) {
                            currentPrice = basePrice;
                        }
                        
                        prices.push(currentPrice);
                        volumes.push(Math.floor(Math.random() * 1000000) + 500000);
                        
                        currentTime += config.interval;
                    }
                    
                    this.candles = {
                        s: 'ok',
                        t: timestamps,
                        c: prices,
                        v: volumes
                    };
                },
                
                // Êõ¥Êñ∞ÂõæË°®
                updateChart() {
                    if (this.chart) {
                        this.chart.destroy();
                    }
                    
                    const ctx = document.getElementById('stockChart');
                    if (!ctx || !this.candles || this.candles.s !== 'ok') return;
                    
                    const chartCtx = ctx.getContext('2d');
                    const gradient = chartCtx.createLinearGradient(0, 0, 0, 400);
                    
                    const isPositive = this.quote?.d >= 0;
                    if (isPositive) {
                        gradient.addColorStop(0, 'rgba(239, 68, 68, 0.3)');
                        gradient.addColorStop(1, 'rgba(239, 68, 68, 0.05)');
                    } else {
                        gradient.addColorStop(0, 'rgba(16, 185, 129, 0.3)');
                        gradient.addColorStop(1, 'rgba(16, 185, 129, 0.05)');
                    }
                    
                    const labels = this.candles.t.map(timestamp => this.formatChartLabel(timestamp * 1000));
                    const prices = this.candles.c;
                    
                    this.chart = new Chart(chartCtx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: this.symbol + ' ËÇ°‰ª∑',
                                data: prices,
                                borderColor: isPositive ? '#ef4444' : '#10b981',
                                backgroundColor: gradient,
                                borderWidth: 2,
                                fill: true,
                                tension: 0.1,
                                pointBackgroundColor: isPositive ? '#ef4444' : '#10b981',
                                pointBorderColor: '#ffffff',
                                pointBorderWidth: 2,
                                pointRadius: 1,
                                pointHoverRadius: 6
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                intersect: false,
                                mode: 'index'
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(17, 24, 39, 0.95)',
                                    titleColor: '#f9fafb',
                                    bodyColor: '#f9fafb',
                                    borderColor: isPositive ? '#ef4444' : '#10b981',
                                    borderWidth: 2,
                                    cornerRadius: 8,
                                    displayColors: false,
                                    padding: 12,
                                    callbacks: {
                                        title: (context) => {
                                            return this.formatTooltipTitle(context[0].label);
                                        },
                                        label: (context) => {
                                            const price = '$' + context.parsed.y.toFixed(2);
                                            const volume = this.candles.v[context.dataIndex];
                                            return [
                                                `${this.language === 'zh' ? '‰ª∑Ê†º' : 'Price'}: ${price}`,
                                                `${this.language === 'zh' ? 'Êàê‰∫§Èáè' : 'Volume'}: ${this.formatVolume(volume)}`
                                            ];
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    grid: {
                                        color: 'rgba(156, 163, 175, 0.2)'
                                    },
                                    ticks: {
                                        color: '#6b7280',
                                        font: {
                                            size: 12
                                        },
                                        maxTicksLimit: 8
                                    }
                                },
                                y: {
                                    position: 'right',
                                    grid: {
                                        color: 'rgba(156, 163, 175, 0.2)'
                                    },
                                    ticks: {
                                        color: '#6b7280',
                                        font: {
                                            size: 12
                                        },
                                        callback: function(value) {
                                            return '$' + value.toFixed(2);
                                        }
                                    }
                                }
                            },
                            animation: {
                                duration: 1000,
                                easing: 'easeInOutQuart'
                            }
                        }
                    });
                },
                
                // Âä†ËΩΩKÁ∫øÊï∞ÊçÆ
                loadCandles() {
                    this.generateMockCandles();
                    this.updateChart();
                },
                
                // ÂºÄÂßãËá™Âä®Âà∑Êñ∞
                startAutoRefresh() {
                    // ÊØè30ÁßíÊ®°Êãü‰ª∑Ê†ºÂèòÂä®
                    setInterval(() => {
                        if (this.quote && !this.loading) {
                            // Ê®°ÊãüÂ∞èÂπÖ‰ª∑Ê†ºÂèòÂä®
                            const change = (Math.random() - 0.5) * 0.01 * this.quote.c;
                            this.quote.c += change;
                            this.quote.d += change;
                            this.quote.dp = (this.quote.d / this.quote.pc) * 100;
                        }
                    }, 30000);
                },
                
                // Ëé∑ÂèñË¥¢Âä°ÊåáÊ†á
                getFinancialMetrics() {
                    if (!this.companyProfile) return [];
                    
                    return [
                        {
                            key: 'marketCap',
                            zh: 'Â∏ÇÂÄº',
                            en: 'Market Cap',
                            value: this.formatMarketCap(this.companyProfile.marketCapitalization),
                            tooltip_zh: 'ÂÖ¨Âè∏ÊÄªÂ∏ÇÂÄº',
                            tooltip_en: 'Total market capitalization'
                        },
                        {
                            key: 'employees',
                            zh: 'ÂëòÂ∑•Êï∞',
                            en: 'Employees',
                            value: this.formatNumber(this.companyProfile.employeeTotal),
                            tooltip_zh: 'ÂÖ¨Âè∏ÂëòÂ∑•ÊÄªÊï∞',
                            tooltip_en: 'Total number of employees'
                        },
                        {
                            key: 'exchange',
                            zh: '‰∫§ÊòìÊâÄ',
                            en: 'Exchange',
                            value: this.companyProfile.exchange || 'N/A',
                            tooltip_zh: 'ËÇ°Á•®‰∫§ÊòìÊâÄ',
                            tooltip_en: 'Stock exchange'
                        }
                    ];
                },
                
                // Â∑•ÂÖ∑ÂáΩÊï∞
                toggleLanguage() {
                    this.language = this.language === 'zh' ? 'en' : 'zh';
                    localStorage.setItem('language', this.language);
                },
                
                getConnectionText() {
                    const texts = {
                        'status-connected': { zh: 'Ê®°ÊãüËøûÊé•', en: 'Demo Connected' },
                        'status-connecting': { zh: 'ËøûÊé•‰∏≠...', en: 'Connecting...' },
                        'status-disconnected': { zh: 'ËøûÊé•Êñ≠ÂºÄ', en: 'Disconnected' }
                    };
                    return texts[this.connectionStatus]?.[this.language] || '';
                },
                
                formatPrice(price) {
                    if (!price && price !== 0) return 'N/A';
                    return '$' + price.toFixed(2);
                },
                
                formatChange(change) {
                    if (!change && change !== 0) return 'N/A';
                    const sign = change >= 0 ? '+' : '';
                    return sign + '$' + change.toFixed(2);
                },
                
                formatPercent(percent) {
                    if (!percent && percent !== 0) return 'N/A';
                    const sign = percent >= 0 ? '+' : '';
                    return '(' + sign + percent.toFixed(2) + '%)';
                },
                
                formatMarketCap(marketCap) {
                    if (!marketCap) return 'N/A';
                    const cap = marketCap * 1000000; // ÂÅáËÆæËæìÂÖ•ÊòØÁôæ‰∏á‰∏∫Âçï‰Ωç
                    
                    if (this.language === 'zh') {
                        if (cap >= 1000000000000) {
                            return (cap / 1000000000000).toFixed(1) + '‰∏á‰∫ø';
                        } else if (cap >= 100000000000) {
                            return (cap / 100000000000).toFixed(0) + 'ÂçÉ‰∫ø';
                        }
                    } else {
                        if (cap >= 1000000000000) {
                            return '$' + (cap / 1000000000000).toFixed(1) + 'T';
                        } else if (cap >= 1000000000) {
                            return '$' + (cap / 1000000000).toFixed(0) + 'B';
                        }
                    }
                    return '$' + (cap / 1000000).toFixed(0) + 'M';
                },
                
                formatNumber(num) {
                    if (!num) return 'N/A';
                    if (this.language === 'zh') {
                        if (num >= 10000) {
                            return (num / 10000).toFixed(1) + '‰∏á';
                        }
                    } else {
                        if (num >= 1000000) {
                            return (num / 1000000).toFixed(1) + 'M';
                        } else if (num >= 1000) {
                            return (num / 1000).toFixed(1) + 'K';
                        }
                    }
                    return num.toLocaleString();
                },
                
                formatVolume(volume) {
                    if (!volume) return '0';
                    if (volume >= 1000000) {
                        return (volume / 1000000).toFixed(1) + 'M';
                    } else if (volume >= 1000) {
                        return (volume / 1000).toFixed(1) + 'K';
                    }
                    return volume.toLocaleString();
                },
                
                formatChartLabel(timestamp) {
                    const date = new Date(timestamp);
                    if (this.selectedPeriod === '1D') {
                        return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                    } else if (this.selectedPeriod === '1W') {
                        return date.toLocaleDateString('en-US', { weekday: 'short' });
                    } else {
                        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    }
                },
                
                formatTooltipTitle(label) {
                    if (this.language === 'zh') {
                        return 'Êó∂Èó¥: ' + label;
                    } else {
                        return 'Time: ' + label;
                    }
                },
                
                formatNewsTime(timestamp) {
                    const date = new Date(timestamp * 1000);
                    const now = new Date();
                    const diffMs = now - date;
                    const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                    const diffDays = Math.floor(diffHours / 24);
                    
                    if (this.language === 'zh') {
                        if (diffDays > 0) {
                            return diffDays + 'Â§©Ââç';
                        } else if (diffHours > 0) {
                            return diffHours + 'Â∞èÊó∂Ââç';
                        } else {
                            return 'ÂàöÂàö';
                        }
                    } else {
                        if (diffDays > 0) {
                            return diffDays + 'd ago';
                        } else if (diffHours > 0) {
                            return diffHours + 'h ago';
                        } else {
                            return 'Just now';
                        }
                    }
                },
                
                getLastUpdateText() {
                    const now = new Date();
                    const timeStr = now.toLocaleTimeString('en-US', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        second: '2-digit'
                    });
                    
                    if (this.language === 'zh') {
                        return `Ê®°ÊãüÊõ¥Êñ∞ ${timeStr}`;
                    } else {
                        return `Demo Update ${timeStr}`;
                    }
                }
            }
        }
    </script>
</body>
</html>